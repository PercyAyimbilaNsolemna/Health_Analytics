QUESTION: Monthly Encounters by Specialty

SQL QUERY:
            SELECT
                DATE_FORMAT(e.encounter_date, '%Y-%m') AS encounter_month,
                s.specialty_name,
                e.encounter_type,
                COUNT(e.encounter_id) AS total_encounters,
                COUNT(DISTINCT e.patient_id) AS unique_patients
            FROM encounters e
            JOIN providers p
                ON e.provider_id = p.provider_id
            JOIN specialties s
                ON p.specialty_id = s.specialty_id
            GROUP BY
                encounter_month,
                s.specialty_name,
                e.encounter_type
            ORDER BY
                encounter_month,
                s.specialty_name,
                e.encounter_type;

SCHEMA ANALYSIS:

TABLES JOINED: encounters, providers, specialties

NUMBER OF JOINS: 2

PERFORMANCE:
            EXECUTION TIME (Not constant): 0.24 ms

            ESTIMATED ROWS SCANNED: 27

            ESTIMATED QUERY COST: 9



Bottleneck Identified:

            DATE_FORMAT(e.encounter_date, '%Y-%m') AS encounter_month

            1. The statement above applies a function on a column in the SELECT and GROUP BY.

            2. MySQL cannot use an index on encounter_date for grouping or sorting.

            3. As encounters grows, this forces:

                Full scan (or wide index scan)

                Expensive grouping and sorting


            EVIDENCE IN EXECUTION PLAN IN THE NOTEBOOK

            1. No index usage on encounter_date

            2. Sorting happens after streaming results (Step 8)